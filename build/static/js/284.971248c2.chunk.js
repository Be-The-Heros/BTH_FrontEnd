"use strict";(self.webpackChunkbtn_frontend=self.webpackChunkbtn_frontend||[]).push([[284],{22284:function(e,t,n){n.d(t,{r:function(){return ne}});var i,o=n(50678),s=n(26248),r=n(59491),a=n(17300),d=n(36161),c=n(83061),l=n(91504),m=n(43822),u=n(47313),f=n(17186),p=n(49814).ZP.div(i||(i=(0,f.Z)(["\n  .description {\n    font-size: 1em;\n    margin-top: 1em;\n    line-height: 1.5em;\n  }\n  .btn-login {\n    margin-top: 1.5em;\n  }\n"]))),h=n(72255),v=n(97890),x=n(46417),_=function(e){var t=e.isOpen,n=void 0===t||t,i=e.onClose,o=(0,v.s0)();return(0,x.jsx)(m.Z,{title:"Login to continue",visible:n,onCancel:i,footer:[],children:(0,x.jsxs)(p,{className:"popup-login",children:[(0,x.jsx)("div",{className:"logo",children:(0,x.jsx)("img",{src:h.Z,alt:"logo"})}),(0,x.jsx)("div",{className:"description",children:"We are a place where volunteers can connect with each other, helping disadvantaged people to improve their lives."}),(0,x.jsxs)("div",{className:"w-100 d-flex",children:[(0,x.jsx)(r.Z,{className:"btn-login ml-auto mr-auto btn-primary",onClick:function(){return o("/auth/sign-in")},children:"Login"}),(0,x.jsx)(r.Z,{className:"btn-login ml-auto mr-auto",onClick:function(){return o("/auth/sign-up")},children:"Create Account"})]})]})})},g=n(47163),j=n(62716),y=n(40056),b=n(24e3),w=n(11822),Z=n.n(w),N=n(5958),S=n(58821),C=n(26672),I=n(37394),k=n(90820),A=n(26555),E=n(41508),L=n(8512),R=n(64605),P=n(17778),z=n(31303),F=n(14133),T=(0,R.cn)({key:"CMT_PUSH_SUB",default:{type:"add",postId:0,content:"",comment_id:0,uid:"",profile:{uid:"",first_name:"",last_name:"",avatar:"",address:"",bio:""},created_at:""}}),D={apiVersion:j.XZ.comment},J=n(70685),M=n(43220),B=n(74740),V=n(45304),K=n(57864),O=J.Z.TextArea,U=function(e){var t=e.post_id,n=e.rep,i=e.contentValue,s=e.isShowAvatar,a=e.type,d=e.commentId,c=e.setIsEditCmt,m=(e.defaultValue,(0,R.sJ)(P.K)),f=(0,u.useState)(""),p=(0,o.Z)(f,2),h=p[0],v=p[1],_=(0,R.sJ)(T),g=function(){var e=(0,R.Zl)(T),t=(0,R.sJ)(P.K);return(0,y.useMutation)((function(e){return j.ZP.post(D,"/create-comment-in-post",{body:e})}),{onSuccess:function(n){e({type:"add",content:n.content||"",postId:n.post_id,rep:null===n||void 0===n?void 0:n.rep,uid:n.uid,comment_id:n.comment_id,created_at:n.created_at||"",profile:{avatar:t.avatar||"",uid:t.uid,first_name:t.first_name,last_name:t.last_name}})},onError:function(e){console.log(e)}})}(),b=g.mutate,w=g.isLoading,Z=function(){var e=(0,R.Zl)(T),t=(0,R.sJ)(P.K);return(0,y.useMutation)((function(e){return j.ZP.put(D,"/edit-comment-in-post",{body:e})}),{onSuccess:function(n){e({type:"edit",content:n.content||"",postId:n.post_id,rep:null===n||void 0===n?void 0:n.rep,uid:n.uid,created_at:n.created_at||"",comment_id:n.comment_id,profile:{avatar:t.avatar||"",uid:t.uid,first_name:t.first_name,last_name:t.last_name}})},onError:function(e){console.log(e)}})}(),N=Z.mutate;Z.isLoading;(0,u.useEffect)((function(){_.uid&&v("")}),[_]),(0,u.useEffect)((function(){i&&v(i)}),[i,d]);return(0,x.jsx)("div",{children:m.uid&&(0,x.jsx)(M.Z,{style:{padding:"10px 0",paddingBottom:0},avatar:s&&(0,x.jsx)(l.E,{showPopover:!1,srcAvatar:m.avatar||"",uid:m.uid,size:32,fullName:m.first_name+" "+m.last_name}),content:(0,x.jsxs)(u.Fragment,{children:[(0,x.jsxs)(B.Z.Item,{style:{marginBottom:"5px"},children:[(0,x.jsx)(O,{onChange:function(e){return function(e){v(e.target.value)}(e)},value:h,autoSize:!0}),"create"===a&&(0,x.jsx)(V.Z,{title:"Choose imge",children:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("label",{htmlFor:"file-upload",style:{position:"absolute",bottom:"10px",right:"10px",cursor:"pointer"},children:(0,x.jsx)(K.rJU,{size:20})}),(0,x.jsx)("input",{accept:"image/png, image/jpeg",id:"file-upload",style:{display:"none"},type:"file"})]})})]}),(0,x.jsx)(B.Z.Item,{style:{marginBottom:"5px"},children:(0,x.jsx)(r.Z,{loading:w,onClick:function(){"create"===a?h.length>0&&b({content:h,post_id:t,rep:n}):(d&&N({comment_id:d,content:h,post_id:t}),c&&c(!1))},style:{background:"#7cdfff",border:"none",color:"var(--bs-gray-dark)"},htmlType:"submit",type:"primary",disabled:w||0===h.trim().length,children:"create"===a?"Comment":"Save"})})]})})})},W=n(57923),Q=n.n(W),q=n(32878),$=n(29466),G=n(63733),H=function(e){var t=e.onShowAddCmt,n=e.isShowAddCmt,i=e.content,s=e.avatar,a=e.comment_id,d=e.post_id,c=e.child,m=e.repId,f=e.total,p=e.isChild,h=s.srcAvatar,v=s.uid,g=s.fullName,b=s.bio,w=s.address,Z=(0,u.useState)(!1),S=(0,o.Z)(Z,2),C=S[0],I=S[1],k=(0,u.useState)(!1),A=(0,o.Z)(k,2),E=A[0],L=A[1],z=(0,R.sJ)(P.K),F=(0,u.useState)(!1),J=(0,o.Z)(F,2),B=J[0],V=J[1],K=function(){var e=(0,R.Zl)(T),t=(0,R.sJ)(P.K);return(0,y.useMutation)((function(e){return j.ZP.delete(D,"/remove-comment-in-post",{body:e})}),{onSuccess:function(n){e({type:"remove",content:n.content||"",postId:n.post_id,rep:null===n||void 0===n?void 0:n.rep,uid:n.uid,comment_id:n.comment_id,created_at:n.created_at||"",profile:{avatar:t.avatar||"",uid:t.uid,first_name:t.first_name,last_name:t.last_name}})},onError:function(e){console.log(e)}})}(),O=K.mutate,W=(K.isLoading,function(){O({comment_id:a,post_id:d})}),Q=function(){L(!E)};return(0,x.jsxs)("div",{className:"comment-custom",onMouseOut:function(){return I(!0)},onMouseLeave:function(){return I(!1)},children:[(0,x.jsx)(_,{isOpen:B&&!z.isLoggedIn,onClose:function(){return V(!B)}}),(0,x.jsx)(M.Z,{actions:[(0,x.jsxs)("div",{onClick:function(){t(!n),V(!B)},style:{cursor:"pointer"},children:[(0,x.jsx)(G.cWV,{style:{transform:"scale(-1,1)",marginRight:"5px"}}),"".concat(p||!f?"Reply":f+" replies"," ")]},"comment-nested-reply-to d-flex align-items-center justify-content-center")],author:(0,x.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,x.jsx)($.rU,{to:"/profile/".concat(v),style:{textDecoration:"none",color:"#1a3353",fontWeight:"500",fontSize:"1rem",marginTop:"0.25rem"},children:g}),v===z.uid&&(0,x.jsx)("div",{style:{visibility:C?"unset":"hidden"},children:(0,x.jsx)(q.Z,{trigger:"click",content:function(){return(0,x.jsxs)("div",{children:[(0,x.jsx)(r.Z,{danger:!0,onClick:W,children:"Delete"}),(0,x.jsx)(r.Z,{size:"small",style:{marginLeft:"5px",borderColor:"var(--bs-warning)",color:"var(--bs-warning)"},onClick:Q,children:"Edit"})]})},children:(0,x.jsx)(N.T41,{})})})]}),avatar:(0,x.jsx)(l.E,{showPopover:!0,srcAvatar:h,uid:v,size:32,fullName:g,bio:b,address:w}),content:E?(0,x.jsx)(U,{post_id:d,contentValue:i,isShowAvatar:!1,type:"edit",commentId:a,rep:m,setIsEditCmt:L}):(0,x.jsx)("div",{style:{background:"#F0F2F5",borderRadius:"10px",padding:"0.35rem",color:"#000"},children:i}),children:c})]})},X=function(e){var t=e.data,n=t.profile,i=t.content,s=t.commentReps,r=t.post_id,a=t.comment_id,d=(0,u.useState)(!1),c=(0,o.Z)(d,2),l=c[0],m=c[1],f=(0,u.useState)(!0),p=(0,o.Z)(f,2),h=p[0],v=p[1];u.useEffect((function(){s&&s.length<3&&v(!1)}),[]);var _=h&&Q()(null===s||void 0===s?void 0:s.length)>3?Q()(null===s||void 0===s?void 0:s.length)-3:0;return(0,x.jsx)(H,{post_id:r,comment_id:a,total:(null===s||void 0===s?void 0:s.length)||0,avatar:{showPopover:!0,srcAvatar:n.avatar,uid:n.uid,fullName:n.first_name+" "+n.last_name,bio:n.bio,address:n.address},content:i||"",isShowAddCmt:l,onShowAddCmt:m,child:(0,x.jsxs)(u.Fragment,{children:[h&&s&&s.length>3&&(0,x.jsx)("div",{className:"comment-more",onClick:function(){return v(!1)},style:{cursor:"pointer"},children:"See all replies comments"}),(null===s||void 0===s?void 0:s.length)&&s.sort((function(e,t){return new Date(e.created_at||"").getTime()-new Date(t.created_at||"").getTime()})).slice(_,null===s||void 0===s?void 0:s.length).map((function(e,t){var n=e.profile,i=e.content,o=e.comment_id;return(0,x.jsx)(H,{post_id:r,comment_id:o,total:(null===s||void 0===s?void 0:s.length)||0,isChild:!0,avatar:{showPopover:!0,srcAvatar:n.avatar,uid:n.uid,fullName:n.first_name+" "+n.last_name,bio:n.bio,address:n.address},content:i||"",isShowAddCmt:l,onShowAddCmt:m},t)})),l&&(0,x.jsx)(U,{post_id:+r,rep:a,isShowAvatar:!0,type:"create",defaultValue:n.first_name+" "+n.last_name})]})})},Y=(0,u.memo)((function(e){var t=e.data,n=u.useState(!0),i=(0,o.Z)(n,2),s=i[0],r=i[1];return(0,x.jsxs)(u.Fragment,{children:[t.length&&t.sort((function(e,t){return new Date(t.created_at||"").getTime()-new Date(e.created_at||"").getTime()})).slice(0,s?3:t.length).map((function(e,t){return(0,x.jsx)(X,{data:e},t)})),s&&t.length>3&&(0,x.jsx)("div",{className:"comment-more",onClick:function(){return r(!1)},style:{cursor:"pointer"},children:"See all comments"})]})})),ee=function(e){var t=e.postId,n=(0,R.sJ)(T),i=(0,u.useState)([]),s=(0,o.Z)(i,2),r=s[0],a=s[1],d=function(e){return(0,y.useQuery)(["QUERY_COMMENT"+e,e],(function(){return j.ZP.get(D,"/get-list-comments-of-post?idPost=".concat(e))}),{retry:!1,refetchOnWindowFocus:!1,refetchInterval:!1})}(t),c=d.isLoading,l=d.error,m=d.data;return(0,u.useEffect)((function(){if(n.content&&n.postId&&Q()(n.postId)===Q()(t))switch(console.log("subComment.type",n.type),n.type){case"add":var e=(0,z.Z)(r),i={comment_id:n.comment_id,content:n.content,rep:n.rep,uid:n.uid,profile:n.profile,post_id:n.postId,created_at:n.created_at};if(n.rep){var o=e.findIndex((function(e){return e.comment_id===n.rep}));-1!==o&&(e[o].commentReps=[].concat((0,z.Z)(e[o].commentReps||[]),[i]))}else e.push(i);a(e);break;case"remove":var s=(0,z.Z)(r);if(n.rep){var d=s.findIndex((function(e){return e.comment_id===n.rep&&e.commentReps}));-1!==d&&(s[d].commentReps=(0,z.Z)((s[d].commentReps||[]).filter((function(e){return e.comment_id!==n.comment_id})))),a(s)}else{var c=s.filter((function(e){return e.comment_id!==n.comment_id}));a(c)}break;case"edit":var l=(0,z.Z)(r);if(console.log("run switch edit"),n.rep){var m=l.findIndex((function(e){return e.comment_id===n.rep&&e.commentReps}));if(-1!==m){var u=(l[m].commentReps||[]).findIndex((function(e){return e.comment_id===n.comment_id}));if(l[m].commentReps&&-1!==u){var f=l[m].commentReps;f&&f[u]&&(f[u].content=n.content)}}a(l)}else{var p=l.findIndex((function(e){return e.comment_id===n.comment_id}));l[p].content=n.content,a(l)}}}),[n.comment_id,n.content,n.postId,n.type]),(0,u.useEffect)((function(){!l&&m&&a(m)}),[c,l,m]),(0,x.jsx)("div",{children:c?(0,x.jsx)("div",{style:{paddingTop:"10px"},children:(0,x.jsx)(F.Z,{avatar:!0,paragraph:{rows:1}})}):(0,x.jsxs)(u.Fragment,{children:[(0,x.jsx)(U,{post_id:t,isShowAvatar:!0,type:"create"}),(0,x.jsx)(Y,{data:r})]})})},te=n(61247),ne=function(e){var t=(0,R.sJ)(P.K),n=(0,v.s0)(),i=e.handleDeletePost,m=u.useState(!1),f=(0,o.Z)(m,2),p=f[0],h=f[1],w=(0,y.useMutation)((function(e){return j.ZP.delete(b.V,"/delete",{body:e})})),z="https://betheheros.tk/post/detail/".concat(e.post_id);u.useEffect((function(){L.Am.dismiss(),w.isSuccess?i&&i(Z()(e.post_id)):w.isError?L.Am.error("Something went wrong"):w.isLoading&&L.Am.loading("Deleting your post...")}),[w.isLoading,w.isSuccess,w.data,w.isError]);var F=t.uid===e.uid,T=(0,x.jsxs)(s.Z,{children:[F&&(0,x.jsxs)(u.Fragment,{children:[(0,x.jsx)(s.Z.Item,{children:(0,x.jsxs)(r.Z,{className:"w-100",style:{backgroundColor:"var(--bs-success)",color:"var(--bs-white)"},onClick:function(){return n("/edit-post/".concat(e.post_id))},children:["Edit"," "]})}),(0,x.jsx)(s.Z.Item,{children:(0,x.jsx)(r.Z,{disabled:w.isLoading,onClick:function(){w.mutate({post_id:e.post_id})},className:"w-100",style:{backgroundColor:"var(--bs-danger)",color:"var(--bs-white)"},children:"Delete"})})]}),(0,x.jsx)(s.Z.Item,{children:(0,x.jsx)(r.Z,{className:"w-100",style:{backgroundColor:"var(--bs-warning)",color:"var(--bs-white)"},onClick:function(){return n("/post/detail/".concat(e.post_id))},children:"View detail"})})]}),D=(0,x.jsxs)(s.Z,{children:[(0,x.jsx)(s.Z.Item,{icon:(0,x.jsx)(C.Am9,{color:"#3e79f7",style:{marginRight:"0.25rem"}}),className:"d-flex align-items-center",children:(0,x.jsx)(A.Z,{hashtag:"#be_the_heroes",quote:e.title,url:z,children:"Share with Facebook"})},"1"),(0,x.jsx)(s.Z.Item,{icon:(0,x.jsx)(S.NQh,{color:"#3e79f7",style:{marginRight:"0.25rem"}}),className:"d-flex  align-items-center"},"2"),(0,x.jsx)(s.Z.Item,{icon:(0,x.jsx)(S.meP,{color:"#3e79f7",style:{marginRight:"0.25rem"}}),className:"d-flex  align-items-center",children:(0,x.jsx)(E.Z,{url:z,hashtags:["be_the_heroes"],title:e.title,children:"Share with Twitter"})},"2")]}),J=u.useState(""),M=(0,o.Z)(J,2),B=M[0],V=M[1],K=u.useState("See more..."),O=(0,o.Z)(K,2),U=O[0],W=O[1];return(0,x.jsxs)(u.Fragment,{children:[(0,x.jsx)(_,{isOpen:p&&!t.isLoggedIn,onClose:function(){return h(!1)}}),(0,x.jsxs)(te.Z,{children:[(0,x.jsxs)("div",{className:"Newfeed_head",children:[(0,x.jsxs)("div",{className:"Newfeed_head_info",children:[(0,x.jsx)(l.E,{showPopover:!0,size:64,bio:e.bio,fullName:e.fullname,uid:e.uid,address:e.user_address,srcAvatar:e.avatar}),(0,x.jsxs)("div",{className:"Newfeed_head_info_detail",children:[(0,x.jsxs)("div",{className:"d-flex align-items-center",style:{fontWeight:"bold"},children:[e.fullname,e.level>2&&(0,x.jsx)(I.pl0,{style:{marginLeft:"0.5rem",fontSize:"1rem"}})]}),(0,x.jsx)("div",{className:"w-100",style:{marginBottom:"0.25rem"},children:new Date(e.updated_at).toDateString()}),(0,x.jsxs)("div",{className:"Newfeed_head_info_detail_locate",children:[(0,x.jsx)(k.ZBQ,{style:{fontSize:"1.25rem"},color:"red"}),(0,x.jsx)("div",{children:e.residential_address})]})]})]}),(0,x.jsx)("div",{className:"Newfeed_head_join",children:e.join_url&&(0,x.jsx)(r.Z,{className:"Newfeed_head_join_button",type:"ghost",onClick:function(){var i;if(h(!0),t.isLoggedIn){if(null!==(i=e.join_url)&&void 0!==i&&i.includes("/chat"))return void n("/invite/".concat(e.post_id));window.open(e.join_url,"_blank")}},children:"Join"})})]}),(0,x.jsxs)("div",{className:"Newfeed_body",children:[(0,x.jsx)("h3",{children:e.title}),(0,x.jsx)("div",{className:"Newfeed_body_title d-flex justify-content-start",children:(0,x.jsxs)("div",{className:"text",children:["Address:"," ",[e.residential_address,e.ward,e.district,e.province].filter((function(e){return""!==(null===e||void 0===e?void 0:e.trim())&&void 0!==e})).join(", ")]})}),(0,x.jsxs)("div",{className:"Newfeed_body_content",children:[(0,x.jsx)("span",{className:"Newfeed_body_content_comment ".concat(B),children:e.content}),e.content.length<300?"":(0,x.jsx)("button",{className:"Newfeed_body_content_button",onClick:function(){""===B?(V("none"),W("See less...")):(V(""),W("See more..."))},children:U})]}),(0,x.jsx)("div",{className:"Newfeed_body_photos",children:e.photos&&e.photos.length>0&&(0,x.jsxs)(a.Z.PreviewGroup,{children:[" ",function(){var t=e.photos;return t&&0!==t.length?t.map((function(e,n){var i=n+1===g.lI,o=(0,c.Z)([{"d-none":n+1>g.lI},"w-50 position-relative d-flex justify-content-center",{"w-100":3===t.length&&2===n||1===t.length}]);return(0,x.jsxs)("div",{className:o,children:[(0,x.jsx)(a.Z,{src:e,alt:"post",style:{border:t.length>1?"2.25px solid var(--border)":"none"}}),g.lI!=t.length&&i&&(0,x.jsxs)("div",{className:"position-absolute d-flex justify-content-center align-items-center",style:{top:"50%",color:"#f5f5f5",left:"50%",fontSize:"2rem",transform:"translate(-50%, -50%)",width:"100%"},children:["+",t.length-g.lI]})]},n)})):null}()]})})]}),(0,x.jsxs)("div",{className:"Newfeed_footer",children:[(0,x.jsx)(d.Z,{overlay:D,children:(0,x.jsxs)(r.Z,{type:"link",children:[(0,x.jsx)(I.Nxq,{style:{fontSize:"150%",margin:"0 0.5rem 0.2rem"}})," ","Share"]})}),(0,x.jsxs)(r.Z,{type:"link",style:{color:"#673AB7"},onClick:function(){h(!0)},children:[(0,x.jsx)(I.L4e,{color:"#673AB7",style:{fontSize:"120%",margin:"0 0.5rem 0.2rem"}})," ","Comment"]}),(0,x.jsx)(d.Z,{overlay:T,placement:"bottomLeft",children:(0,x.jsxs)(r.Z,{type:"link",children:[(0,x.jsx)(N.p$$,{color:"var(--bs-success)",style:{fontSize:"120%",margin:"0 0.5rem 0.2rem"}}),"More"]})})]}),(0,x.jsx)(ee,{postId:+e.post_id})]})]})}}}]);